<!DOCTYPE html>
<html>
<head>
    <title>Dex-Liquidity API</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .endpoint { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        code { background: #e8e8e8; padding: 2px 4px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Dex-Liquidity API</h1>
    <p>Uniswap v3 pool metrics for D.FAITH token on Base chain</p>
    
    <h2>Endpoints</h2>
    <div class="endpoint">
        <strong>GET /api/health</strong><br>
        Health check endpoint
    </div>
    
    <div class="endpoint">
        <strong>GET /api/metrics</strong><br>
        Token pool metrics<br>
        Parameters: <code>token</code> (address), <code>chainId</code> (default: 8453)
    </div>
    
    <h2>Example</h2>
    <div class="endpoint">
        <a href="/api/metrics?token=0x69eFD833288605f320d77eB2aB99DDE62919BbC1&chainId=8453">
            /api/metrics?token=0x69eFD833288605f320d77eB2aB99DDE62919BbC1&chainId=8453
        </a>
    </div>
    
    <script>
        let updateInterval;
        
        function fetchAndDisplay() {
            fetch('/api/metrics?token=0x69eFD833288605f320d77eB2aB99DDE62919BbC1&chainId=8453')
                .then(r => r.json())
                .then(data => {
                    const existing = document.getElementById('live-metrics');
                    if (existing) existing.remove();
                    
                    if (data.marketCapEUR) {
                        const timestamp = new Date().toLocaleTimeString();
                        document.body.innerHTML += `
                            <div id="live-metrics" class="endpoint">
                                <h2>üî¥ Live D.FAITH Metrics</h2>
                                <div style="font-size: 0.9em; color: #666; margin-bottom: 10px;">Last updated: ${timestamp}</div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div><strong>Market Cap (EUR):</strong><br>‚Ç¨${data.marketCapEUR.circulating.toLocaleString('de-DE', {minimumFractionDigits: 2})}</div>
                                    <div><strong>Token Price (EUR):</strong><br>‚Ç¨${data.priceEUR?.toFixed(6)}</div>
                                    <div><strong>Pool Liquidity:</strong><br>${data.balances.tokenInPool} D.FAITH</div>
                                    <div><strong>WETH in Pool:</strong><br>${data.balances.quoteInPool?.toFixed(6)} WETH</div>
                                </div>
                                <div style="margin-top: 10px;">
                                    <button onclick="toggleAutoUpdate()" id="toggle-btn" style="padding: 8px 16px; background: #0070f3; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                        üîÑ Auto-Update: ON (10s)
                                    </button>
                                </div>
                            </div>
                        `;
                    }
                })
                .catch(() => {
                    document.getElementById('live-metrics')?.remove();
                });
        }
        
        function toggleAutoUpdate() {
            const btn = document.getElementById('toggle-btn');
            if (updateInterval) {
                clearInterval(updateInterval);
                updateInterval = null;
                btn.textContent = '‚ñ∂Ô∏è Start Auto-Update';
                btn.style.background = '#666';
            } else {
                updateInterval = setInterval(fetchAndDisplay, 10000);
                btn.textContent = 'üîÑ Auto-Update: ON (10s)';
                btn.style.background = '#0070f3';
            }
        }
        
        // Initial load + start auto-update
        fetchAndDisplay();
        updateInterval = setInterval(fetchAndDisplay, 10000);
    </script>
</body>
</html>
